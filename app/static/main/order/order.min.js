"use strict";function bar_progress(e){var b=$("#progress-bar");var d=b.data("number-of-steps");var a=b.data("now-value");var c=0;if(e==="right"){c=a+(100/d)}else{if(e==="left"){c=a-(100/d)}}b.attr("style","width: "+c+"%;").data("now-value",c)}var LS_ORDER_KEY="order";var LS_ORDER_PACK_ID_KEY="pack_id";var LS_ORDER_ACCOUNT_KEY="account";var LS_ORDER_ACCOUNT_EMAIL_KEY="email";var LS_ORDER_ACCOUNT_PASSWORD_KEY="password";var LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY="password_confirm";$(document).ready(function(){var l=$("meta#email_check_url");var d=$("meta#order_page_url");var s=$("meta#get_payment_url_url");var m=$(".order-form");var e=$("#user_uuid");var w=$("#pack_id");var j=$("#email-input");var x=$("#password-input");var h=$("#repeat-password-input");var f=$("#payment_methods-modal");var u=!!e.val();var p=getFromLocalStorage(LS_ORDER_KEY);var q;if(p){q=p[LS_ORDER_ACCOUNT_KEY]}else{p={}}if(!q){q={}}function i(){if(p){w.val(p[LS_ORDER_PACK_ID_KEY]);if(q){j.val(q[LS_ORDER_ACCOUNT_EMAIL_KEY]);b();x.val(q[LS_ORDER_ACCOUNT_PASSWORD_KEY]);t();h.val(q[LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY]);a()}}}function o(){if(window.location.href.indexOf("pack=")!==-1||(p&&p[LS_ORDER_PACK_ID_KEY])){if(window.location.href.indexOf("pack=")!==-1){p[LS_ORDER_PACK_ID_KEY]=getUrlParameter("pack");setToLocalStorage(LS_ORDER_KEY,p)}else{window.location=d.data("url")+"?pack="+p[LS_ORDER_PACK_ID_KEY]}k("right","account")}else{$("#pack-fieldset").fadeIn("slow")}}i();o();$(".btn-checkout").on("click",function(){p[LS_ORDER_PACK_ID_KEY]=$(this).data("id");var y=setToLocalStorage(LS_ORDER_KEY,p);if(!y){w.val($(this).data("id"))}});$(".order-form .btn-next").on("click",function(){k("right")});$(".order-form .btn-previous").on("click",function(){k("left")});$('.order-form input[type="text"], .order-form input[type="password"], .order-form textarea').on("focus",function(){markInput($(this),true)});$('input[type="text"], input[type="password"]').on("focus",function(){$(this).parent().find(".error").hide()});function k(E,F){var D=$(".order-form").find(".order-progress-step.active");var C=D.data("id");var z=true;if(!F||F===""){if(E==="left"){F=D.prev().data("id")}else{F=D.next().data("id")}}if(E==="right"){z=r(C);if(C==="pack"){z=v()}else{if(C==="account"){z=c()}}}if(!z){return}var y=$('.order-progress-step[data-id="'+F+'"]');var A=$('fieldset[data-id="'+F+'"]');var B=$('fieldset[data-id="'+C+'"]');n(B,D,y,E,A)}function n(A,C,y,B,z){if(B==="right"){C.addClass("activated")}C.addClass("activated");A.fadeOut(400,function(){C.removeClass("active");y.addClass("active").removeClass("activated");bar_progress(B);z.fadeIn();scrollToTop()})}function v(y){if(!y){y=getUrlParameter("pack");if(!y){y=p[LS_ORDER_PACK_ID_KEY];if(!y){y=w.val();if(!y){return false}}}}w.val(y);return true}function c(){if(u){return true}var y=t();if(!y){return false}y=a();return y}function r(z){var y=true;$('fieldset[data-id="'+z+'"]').find('input[type="text"], input[type="password"]').each(function(){if($.trim($(this).val())===""){markInput($(this),false);$(this).parent().find(".empty_error").show();y=false}else{markInput($(this),true);$(this).parent().find(".empty_error").hide()}});return y}$(window).keydown(function(y){if(y.keyCode===13){y.preventDefault();return false}});m.on("submit",function(A){A.preventDefault();var z=$.trim($("#payment_method").val());if(!z||z===""){$("#payment-method-error").show();return false}var y=this;$(y).ajaxSubmit({success:function(B){if(B.success){console.log(JSON.stringify(B));g(function(){setToLocalStorage(LS_ORDER_KEY,"")})}else{if(B.hasOwnProperty("errors")){showErrors(B)}}},error:function(B){console.log(JSON.stringify(B));notyError("error")}})});function g(D){var z=$.trim($("#order_code").text());var A=$.trim($("#subscription-id").val());var C=$.trim($("#payment_method").val());var y=s.data("url");var B=s.data("method");redirectToPaymentPage(z,A,C,"order",y,B,D)}f.on("hide.bs.modal",function(y){if(f.find(".modal-body").find(".payment-method.active").length===0){return}var z=$(".payment-method.active").parent().clone();z.addClass("col-xl-2");$("#payment_methods-container").append(z)});$(document).on("click",".payment-method",function(){$("#payment-method-error").hide();if($(this).hasClass("active")){return}$(".payment-method.active").removeClass("active");$(this).addClass("active");if(f.hasClass("show")){$("#payment_methods-container").find(".payment-method.additional").parent().remove();f.modal("hide")}$("#payment_method").val($(this).data("id"))});j.on("focusout",function(){b()});x.on("focusout",function(){t();a()});h.on("focusout",function(){a()});function b(){var A=$.trim(j.val());if(A===""){markInput(j,false);j.parent().find(".empty_error").show();return false}var C={email:A};var B=true;var y=function(D){if(D.hasOwnProperty("success")&&!D.success){j.parent().find(".busy_error").show();markInput(j,false)}else{j.parent().find(".busy_error").hide();markInput(j,true);q[LS_ORDER_ACCOUNT_EMAIL_KEY]=A;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p)}};var z=function(D){notyError("System Error")};doAjax(l.data("url"),l.data("method"),C,B,y,z)}function t(){var z=$.trim(x.val());var y=x.parent();if(z===""){y.find(".empty_error").show();markInput(x,false);return false}else{if(z.length<6){y.find(".short_error").show();markInput(x,false);return false}else{y.find(".short_error").hide();markInput(x,true);q[LS_ORDER_ACCOUNT_PASSWORD_KEY]=z;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p);return true}}}function a(){var y=$.trim(x.val());var z=$.trim(h.val());if(z===""){markInput(h,false);h.parent().find(".empty_error").show();return false}if(y!==z){markInput(h,false);h.parent().find(".match_error").show();return false}else{markInput(h,true);h.parent().find(".match_error").hide();q[LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY]=z;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p);return true}}});