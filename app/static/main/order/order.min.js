"use strict";function bar_progress(e){var b=$("#progress-bar");var d=b.data("number-of-steps");var a=b.data("now-value");var c=0;if(e==="right"){c=a+(100/d)}else{if(e==="left"){c=a-(100/d)}}b.attr("style","width: "+c+"%;").data("now-value",c)}var LS_ORDER_KEY="order";var LS_ORDER_PACK_ID_KEY="pack_id";var LS_ORDER_ACCOUNT_KEY="account";var LS_ORDER_ACCOUNT_EMAIL_KEY="email";var LS_ORDER_ACCOUNT_PASSWORD_KEY="password";var LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY="password_confirm";$(document).ready(function(){var l=$("meta#email_check_url");var d=$("meta#order_page_url");var r=$("meta#get_payment_url_url");var m=$(".order-form");var e=$("#user_uuid");var v=$("#pack_id");var j=$("#email-input");var w=$("#password-input");var h=$("#repeat-password-input");var f=$("#payment_methods-modal");var t=!!e.val();var p=getFromLocalStorage(LS_ORDER_KEY);var q;if(p){q=p[LS_ORDER_ACCOUNT_KEY]}else{p={}}if(!q){q={}}function i(){if(p){v.val(p[LS_ORDER_PACK_ID_KEY]);if(q){if(q.hasOwnProperty(LS_ORDER_ACCOUNT_EMAIL_KEY)){j.val(q[LS_ORDER_ACCOUNT_EMAIL_KEY]);b()}if(q.hasOwnProperty(LS_ORDER_ACCOUNT_PASSWORD_KEY)){w.val(q[LS_ORDER_ACCOUNT_PASSWORD_KEY]);s()}if(q.hasOwnProperty(LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY)){h.val(q[LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY]);a()}}}}function o(){if(window.location.href.indexOf("pack=")!==-1||(p&&p[LS_ORDER_PACK_ID_KEY])){if(window.location.href.indexOf("pack=")!==-1){p[LS_ORDER_PACK_ID_KEY]=getUrlParameter("pack");setToLocalStorage(LS_ORDER_KEY,p)}else{window.location=d.data("url")+"?pack="+p[LS_ORDER_PACK_ID_KEY]}k("right","account")}else{$("#pack-fieldset").fadeIn("slow")}}i();o();$(".btn-checkout").on("click",function(){p[LS_ORDER_PACK_ID_KEY]=$(this).data("id");var x=setToLocalStorage(LS_ORDER_KEY,p);if(!x){v.val($(this).data("id"))}});$(".order-form .btn-next").on("click",function(){k("right")});$(".order-form .btn-previous").on("click",function(){k("left")});$('.order-form input[type="text"], .order-form input[type="password"], .order-form textarea').on("focus",function(){markInput($(this),true)});$('input[type="text"], input[type="password"]').on("focus",function(){$(this).parent().find(".error").hide()});function k(D,E){var C=$(".order-form").find(".order-progress-step.active");var B=C.data("id");var y=true;if(!E||E===""){if(D==="left"){E=C.prev().data("id")}else{E=C.next().data("id")}}if(B==="pack"){y=u()}else{if(B==="account"){y=c()}}if(!y){return}var x=$('.order-progress-step[data-id="'+E+'"]');var z=$('fieldset[data-id="'+E+'"]');var A=$('fieldset[data-id="'+B+'"]');n(A,C,x,D,z)}function n(z,B,x,A,y){if(A==="right"){B.addClass("activated")}B.addClass("activated");z.fadeOut(400,function(){B.removeClass("active");x.addClass("active").removeClass("activated");bar_progress(A);y.fadeIn();scrollToTop()})}function u(x){if(!x){x=getUrlParameter("pack");if(!x){x=p[LS_ORDER_PACK_ID_KEY];if(!x){x=v.val();if(!x){return false}}}}v.val(x);return true}function c(){b();if(t){return true}if(j.hasClass("is-invalid")){return false}var x=s();if(!x){return false}x=a();return x}$(window).keydown(function(x){if(x.keyCode===13){x.preventDefault();return false}});m.on("submit",function(z){z.preventDefault();var y=$.trim($("#payment_method").val());if(!y||y===""){$("#payment-method-error").show();return false}var x=this;$(x).ajaxSubmit({success:function(A){if(A.success){console.log(JSON.stringify(A));g(function(){setToLocalStorage(LS_ORDER_KEY,"")})}else{if(A.hasOwnProperty("errors")){showErrors(A)}}},error:function(A){console.log(JSON.stringify(A));notyError("error")}})});function g(C){var y=$.trim($("#order_code").text());var z=$.trim($("#subscription-id").val());var B=$.trim($("#payment_method").val());var x=r.data("url");var A=r.data("method");redirectToPaymentPage(y,z,B,"order",x,A,C)}f.on("hide.bs.modal",function(x){if(f.find(".modal-body").find(".payment-method.active").length===0){return}var y=$(".payment-method.active").parent().clone();y.addClass("col-xl-2");$("#payment_methods-container").append(y)});$(document).on("click",".payment-method",function(){$("#payment-method-error").hide();if($(this).hasClass("active")){return}$(".payment-method.active").removeClass("active");$(this).addClass("active");if(f.hasClass("show")){$("#payment_methods-container").find(".payment-method.additional").parent().remove();f.modal("hide")}$("#payment_method").val($(this).data("id"))});j.on("focusout",function(){b()});w.on("focusout",function(){s();a()});h.on("focusout",function(){a()});function b(){var z=$.trim(j.val());if(z===""){markInput(j,false);j.parent().find(".empty_error").show();return false}var B={email:z};var A=true;var x=function(C){if(C.hasOwnProperty("success")&&!C.success){j.parent().find(".busy_error").show();markInput(j,false)}else{j.parent().find(".busy_error").hide();markInput(j,true);q[LS_ORDER_ACCOUNT_EMAIL_KEY]=z;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p)}};var y=function(C){notyError("System Error")};doAjax(l.data("url"),l.data("method"),B,A,x,y)}function s(){var y=$.trim(w.val());var x=w.parent();if(y===""){x.find(".empty_error").show();markInput(w,false);return false}else{if(y.length<6){x.find(".short_error").show();markInput(w,false);return false}else{x.find(".short_error").hide();markInput(w,true);q[LS_ORDER_ACCOUNT_PASSWORD_KEY]=y;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p);return true}}}function a(){var x=$.trim(w.val());var y=$.trim(h.val());if(y===""){markInput(h,false);h.parent().find(".empty_error").show();return false}if(x!==y){markInput(h,false);h.parent().find(".match_error").show();return false}else{markInput(h,true);h.parent().find(".match_error").hide();q[LS_ORDER_ACCOUNT_PASSWORD_CONFIRM_KEY]=y;p[LS_ORDER_ACCOUNT_KEY]=q;setToLocalStorage(LS_ORDER_KEY,p);return true}}});