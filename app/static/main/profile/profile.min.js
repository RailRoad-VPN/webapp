"use strict";$(document).ready(function(){var y=$("meta#change_status_user_device_block_text").data("text");var g=$("meta#email_saved_text").data("text");var x=$("meta#password_saved_text").data("text");var k=$("meta#get_pincode_url");var n=$("meta#renew_sub_url");var C=$("meta#get_order_payment_url");var c=$("meta#delete_user_device_url");var b=$("meta#change_status_user_device_url");var A=$("meta#delete_account_url");var F=$("meta#is_pin_code_activated_url");var a=$("meta#update_email_url");var q=$("meta#update_password_url");var v=$("meta#email_check_url");var I,z,r;var l=$("#profile-menu");var B=l.find("li");var t=B.find("a");var j=$(".generate-pin-btn");var e=$(".is_user_has_active_subscribe").length>0;if(!e){j.addClass("disabled");j.attr("data-toggle","tooltip");$('[data-toggle="tooltip"]').tooltip()}var p=$("#account-email-input");var H=$("#account-password-input");var E=$("#delete-account-email-input");l.append("<li id='magic-line'></li>");var w=$("#magic-line");o(B.first());t.hover(function(){I=$(this);z=I.position().left;r=I.parent().width();w.stop().animate({left:z,width:r})},function(){w.stop().animate({left:w.data("origLeft"),width:w.data("origWidth")})});t.on("click",function(J){o($(this).parent())});function o(J){w.width(J.width()).css("left",J.find("a").position().left).data("origLeft",w.position().left).data("origWidth",w.width())}j.click(function(){if(!e){return false}var L=true;var J=function(M){if(M.hasOwnProperty("success")&&M.success){if(M.hasOwnProperty("data")){$("#pincode-t").text(M.data["pin_code"]);$("#cd_seconds").val(M.data["seconds"]);$.APP.startTimer("cd");unblockPage(function(){$("#pincode-modal").modal("show")})}}else{showErrors(M);unblockPage()}};var K=function(M){notyError("System Error");unblockPage()};blockPage(function(){doAjax(k.data("url"),k.data("method"),{},L,J,K)})});var h;$("#pincode-modal").on("shown.bs.modal",function(){h=setInterval(function(){var L=true;var J=function(M){if(M.success){if(M.hasOwnProperty("data")&&M.data.hasOwnProperty("is_pin_code_activated")){if(M.data["is_pin_code_activated"]){alert("pin code activated")}}}};var K=function(M){notyError("System Error")};doAjax(F.data("url"),F.data("method"),{},L,J,K)},5000)});$("#pincode-modal").on("hide.bs.modal",function(){clearInterval(h)});$(".renew-sub-btn").click(function(){var M=true;var L={sub_id:$(this).data("sub_id"),order_code:$(this).data("order_code"),subscription_uuid:$(this).data("subscription_uuid")};var J=function(N){if(N.success){window.location=N.data["redirect_url"]}else{if(N.hasOwnProperty("errors")){showErrors(N)}}};var K=function(N){notyError("System Error")};doAjax(n.data("url"),n.data("method"),JSON.stringify(L),M,J,K)});var i={};$(".payment-wait").each(function(){var J=$(this).data("order_code");i[J]=setInterval(function(){u(J)},5000)});$(".change-status-device-btn").click(function(){var J=$(this).data("uuid");var K=$(this).data("is_active");var L;if(K===1){L=0}else{L=1}m(J,L)});$(".delete-device-btn").click(function(){var J=$(this).data("uuid");D(J)});p.on("focusout",function(){d()});$("#save-email-btn").click(function(){if(p.hasClass("is-invalid")){markInput(p,false);return false}blockElement(null,$("#save-email-btn"),function(){s(p.val())})});$("#save-password-btn").click(function(){if(p.hasClass("is-invalid")){markInput(p,false);return false}var J=H.val();if(!G()){return false}f(J)});$("#account-delete-btn").click(function(){var L=$.trim(E.val());if(E.data("current_email")!==L){markInput(E,false);E.parent().find(".correct_error").show();return false}E.parent().find(".error").hide();markInput(E,true);var N={email:L};var M=true;var J=function(O){if(O.hasOwnProperty("success")&&!O.success){E.parent().find(".correct_error").show();markInput(E,false)}else{if(O.hasOwnProperty("next")){window.location=O.next}}};var K=function(O){notyError("System Error")};doAjax(A.data("url"),A.data("method"),JSON.stringify(N),M,J,K)});function u(M){var L=true;var J=function(P){if(P.hasOwnProperty("success")&&P.success){if(P.hasOwnProperty("data")){var R=P.data;if(R.hasOwnProperty("order")){var N=R.order;var O=N.is_success;var Q=N.code;if(O===true){clearInterval(i[Q]);window.location.reload()}}}}else{showErrors(P)}};var K=function(N){notyError("System Error")};doAjax(C.data("url").replace(-1,M),C.data("method"),{},L,J,K)}function m(L,Q){var P=$('.user-device[data-uuid="'+L+'"]');var O=P.find(".change-status-device-btn");var N=true;var M={device_uuid:L,status:Q===1};var J=function(R){if(R.hasOwnProperty("success")&&R.success){var S=P.find(".badge");var T;var U;if(Q===1){S.removeClass("badge-warning").addClass("badge-success");U=S.data("active_text");T=O.data("deactivate_text")}else{S.removeClass("badge-success").addClass("badge-warning");U=S.data("inactive_text");T=O.data("activate_text")}O.text(T);S.text(U);O.data("is_active",Q);unblockElement(P)}else{showErrors(R)}};var K=function(R){notyError("System Error")};blockElement(y,P,function(){doAjax(b.data("url"),b.data("method"),JSON.stringify(M),N,J,K)})}function D(L){var N=true;var M={device_uuid:L};var J=function(O){if(O.hasOwnProperty("success")&&O.success){$('.user-device[data-uuid="'+L+'"]').remove()}else{showErrors(O)}};var K=function(O){notyError("System Error")};doAjax(c.data("url"),c.data("method"),JSON.stringify(M),N,J,K)}function f(L){if(L===""){markInput(H,false);H.parent().find(".empty_error").show();return false}var N=true;var M={password:L};var J=function(O){if(O.hasOwnProperty("success")&&O.success){notySuccess(x);unblockElement($("#save-password-btn"))}else{showErrors(O)}};var K=function(O){notyError("System Error")};blockElement(null,$("#save-password-btn"),function(){doAjax(q.data("url"),q.data("method"),JSON.stringify(M),N,J,K)})}function s(L){if(L===""){markInput(p,false);p.parent().find(".empty_error").show();unblockElement($("#save-email-btn"));return false}if(p.data("current_email")===L){unblockElement($("#save-email-btn"));p.parent().find(".same_warning").show();return false}var N=true;var M={email:L};var J=function(O){if(O.hasOwnProperty("success")&&O.success){notySuccess(g);p.data("current_email",L);E.data("current_email",L)}else{showErrors(O)}unblockElement($("#save-email-btn"))};var K=function(O){notyError("System Error")};doAjax(a.data("url"),a.data("method"),JSON.stringify(M),N,J,K)}function d(){var L=$.trim(p.val());if(L===""){markInput(p,false);p.parent().find(".empty_error").show();return false}if(p.data("current_email")===L){return false}var N={email:L};var M=true;var J=function(O){if(O.hasOwnProperty("success")&&!O.success){p.parent().find(".busy_error").show();markInput(p,false)}else{p.parent().find(".error").hide();markInput(p,true)}};var K=function(O){notyError("System Error")};doAjax(v.data("url"),v.data("method"),N,M,J,K)}function G(){var K=$.trim(H.val());var J=H.parent();if(K===""){J.find(".empty_error").show();markInput(H,false);return false}else{if(K.length<6){J.find(".short_error").show();markInput(H,false);return false}else{J.find(".short_error").hide();markInput(H,true);return true}}}});