"use strict";$(document).ready(function(){var x=$("meta#change_status_user_device_block_text").data("text");var g=$("meta#email_saved_text").data("text");var w=$("meta#password_saved_text").data("text");var j=$("meta#get_pincode_url");var m=$("meta#renew_sub_url");var B=$("meta#get_order_payment_url");var c=$("meta#delete_user_device_url");var b=$("meta#change_status_user_device_url");var z=$("meta#delete_account_url");var a=$("meta#update_email_url");var p=$("meta#update_password_url");var u=$("meta#email_check_url");var G,y,q;var k=$("#profile-menu");var A=k.find("li");var s=A.find("a");var i=$("#generate-pin-btn");var e=$(".is_user_has_active_subscribe").length>0;if(!e){i.addClass("disabled");i.attr("disabled",true)}var o=$("#account-email-input");var F=$("#account-password-input");var D=$("#delete-account-email-input");k.append("<li id='magic-line'></li>");var v=$("#magic-line");n(A.first());s.hover(function(){G=$(this);y=G.position().left;q=G.parent().width();v.stop().animate({left:y,width:q})},function(){v.stop().animate({left:v.data("origLeft"),width:v.data("origWidth")})});s.on("click",function(H){n($(this).parent())});function n(H){v.width(H.width()).css("left",H.find("a").position().left).data("origLeft",v.position().left).data("origWidth",v.width())}i.click(function(){if(!e){return false}var J=true;var H=function(K){if(K.hasOwnProperty("success")&&K.success){if(K.hasOwnProperty("data")){$("#pincode-t").text(K.data["pin_code"]);$("#cd_seconds").val(K.data["seconds"]);$.APP.startTimer("cd")}}else{showErrors(K)}};var I=function(K){notyError("System Error")};doAjax(j.data("url"),j.data("method"),{},J,H,I);$("#pincode-modal").modal("show")});$(".renew-sub-btn").click(function(){var K=true;var J={sub_id:$(this).data("sub_id"),order_code:$(this).data("order_code")};var H=function(L){if(L.success){window.location=L.data["redirect_url"]}else{if(L.hasOwnProperty("errors")){showErrors(L)}}};var I=function(L){notyError("System Error")};doAjax(m.data("url"),m.data("method"),JSON.stringify(J),K,H,I)});var h={};$(".payment-wait").each(function(){var H=$(this).data("order_code");h[H]=setInterval(function(){t(H)},5000)});$(".change-status-device-btn").click(function(){var H=$(this).data("uuid");var I=$(this).data("is_active")===true;l(H,!I)});$(".delete-device-btn").click(function(){var H=$(this).data("uuid");C(H)});o.on("focusout",function(){d()});$("#save-email-btn").click(function(){if(o.hasClass("is-invalid")){markInput(o,false);return false}blockElement(null,$("#save-email-btn"),function(){r(o.val())})});$("#save-password-btn").click(function(){if(o.hasClass("is-invalid")){markInput(o,false);return false}var H=F.val();if(!E()){return false}f(H)});$("#account-delete-btn").click(function(){var J=$.trim(D.val());if(D.data("current_email")!==J){markInput(D,false);D.parent().find(".correct_error").show();return false}D.parent().find(".error").hide();markInput(D,true);var L={email:J};var K=true;var H=function(M){if(M.hasOwnProperty("success")&&!M.success){D.parent().find(".correct_error").show();markInput(D,false)}else{if(M.hasOwnProperty("next")){window.location=M.next}}};var I=function(M){notyError("System Error")};doAjax(z.data("url"),z.data("method"),JSON.stringify(L),K,H,I)});function t(K){var J=true;var H=function(N){if(N.hasOwnProperty("success")&&N.success){if(N.hasOwnProperty("data")){var P=N.data;if(P.hasOwnProperty("order")){var L=P.order;var M=L.is_success;var O=L.code;var Q=L.payment_arrived;if(Q===true){clearInterval(h[O]);window.location.reload()}}}}else{showErrors(N)}};var I=function(L){notyError("System Error")};doAjax(B.data("url").replace(-1,K),B.data("method"),{},J,H,I)}function l(K,I){var O=$('.user-device[data-uuid="'+K+'"]');var N=O.find(".change-status-device-btn");var M=true;var L={device_uuid:K,status:I};var H=function(P){if(P.hasOwnProperty("success")&&P.success){var Q=O.find(".badge");var R;var S;if(I===true){Q.removeClass("badge-warning").addClass("badge-success");S=Q.data("active_text");R=N.data("deactivate_text")}else{Q.removeClass("badge-success").addClass("badge-warning");S=Q.data("inactive_text");R=N.data("activate_text")}N.text(R);Q.text(S);N.data("is_active",I);unblockElement(O)}else{showErrors(P)}};var J=function(P){notyError("System Error")};blockElement(x,O,function(){doAjax(b.data("url"),b.data("method"),JSON.stringify(L),M,H,J)})}function C(J){var L=true;var K={device_uuid:J};var H=function(M){if(M.hasOwnProperty("success")&&M.success){$('.user-device[data-uuid="'+J+'"]').remove()}else{showErrors(M)}};var I=function(M){notyError("System Error")};doAjax(c.data("url"),c.data("method"),JSON.stringify(K),L,H,I)}function f(J){if(J===""){markInput(F,false);F.parent().find(".empty_error").show();return false}var L=true;var K={password:J};var H=function(M){if(M.hasOwnProperty("success")&&M.success){notySuccess(w);unblockElement($("#save-password-btn"))}else{showErrors(M)}};var I=function(M){notyError("System Error")};blockElement(null,$("#save-password-btn"),function(){doAjax(p.data("url"),p.data("method"),JSON.stringify(K),L,H,I)})}function r(J){if(J===""){markInput(o,false);o.parent().find(".empty_error").show();unblockElement($("#save-email-btn"));return false}if(o.data("current_email")===J){unblockElement($("#save-email-btn"));o.parent().find(".same_warning").show();return false}var L=true;var K={email:J};var H=function(M){if(M.hasOwnProperty("success")&&M.success){notySuccess(g);o.data("current_email",J);D.data("current_email",J)}else{showErrors(M)}unblockElement($("#save-email-btn"))};var I=function(M){notyError("System Error")};doAjax(a.data("url"),a.data("method"),JSON.stringify(K),L,H,I)}function d(){var J=$.trim(o.val());if(J===""){markInput(o,false);o.parent().find(".empty_error").show();return false}if(o.data("current_email")===J){return false}var L={email:J};var K=true;var H=function(M){if(M.hasOwnProperty("success")&&!M.success){o.parent().find(".busy_error").show();markInput(o,false)}else{o.parent().find(".error").hide();markInput(o,true)}};var I=function(M){notyError("System Error")};doAjax(u.data("url"),u.data("method"),L,K,H,I)}function E(){var I=$.trim(F.val());var H=F.parent();if(I===""){H.find(".empty_error").show();markInput(F,false);return false}else{if(I.length<6){H.find(".short_error").show();markInput(F,false);return false}else{H.find(".short_error").hide();markInput(F,true);return true}}}});