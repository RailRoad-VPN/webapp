"use strict";$(document).ready(function(){let changeStatusUserDeviceBlockText=$("meta#change_status_user_device_block_text").data("text");let emailSavedText=$("meta#email_saved_text").data("text");let passwordSavedText=$("meta#password_saved_text").data("text");let $getPinCodeUrlObj=$("meta#get_pincode_url");let $deleteUserDeviceUrlObj=$("meta#delete_user_device_url");let $changeStatusUserDeviceUrlObj=$("meta#change_status_user_device_url");let $deleteAccountUrlObj=$("meta#delete_account_url");let $isPincodeActivatedUrlObj=$("meta#is_pin_code_activated_url");let $updateEmailUrlObj=$("meta#update_email_url");let $updatePasswordUrlObj=$("meta#update_password_url");let $emailCheckURLObj=$("meta#email_check_url");let $el,leftPos,newWidth;let $menu=$("#profile-menu");let $menuItems=$menu.find("li");let $menuItemsLinks=$menuItems.find("a");let $generatePinBtn=$(".generate-pin-btn");let is_user_has_active_subscribe=$(".is_user_has_active_subscribe").length>0;let generate_available=$("#generate_available").data("value");if(generate_available==="False"){setTimeout(function(){location.reload()},10000);return}if(!is_user_has_active_subscribe){$generatePinBtn.addClass("disabled");$generatePinBtn.attr("data-toggle","tooltip");$('[data-toggle="tooltip"]').tooltip()}let $emailInput=$("#account-email-input");let $passwordInput=$("#account-password-input");let $deleteAccountEmailInput=$("#delete-account-email-input");let vpnServersTable;try{vpnServersTable=$("#vpn_servers-table").DataTable({paging:false,searching:true,language:{url:$("#data_table_lang_url").data("url")}})}catch(e){console.error("vpnServersTable generate error")}$menu.append("<li id='magic-line'></li>");let $magicLine=$("#magic-line");g($menuItems.first());$menuItemsLinks.hover(function(){$el=$(this);leftPos=$el.position().left;newWidth=$el.parent().width();$magicLine.stop().animate({left:leftPos,width:newWidth})},function(){$magicLine.stop().animate({left:$magicLine.data("origLeft"),width:$magicLine.data("origWidth")})});$menuItemsLinks.on("click",function(i){g($(this).parent())});function g(i){$magicLine.width(i.width()).css("left",i.find("a").position().left).data("origLeft",$magicLine.position().left).data("origWidth",$magicLine.width())}$generatePinBtn.click(function(){try{analytics_action("generate_pincode_button")}catch(i){}if(!is_user_has_active_subscribe){return false}let isAsync=true;let successCallback=function(j){if(j.hasOwnProperty("success")&&j.success){if(j.hasOwnProperty("data")){$("#pincode-t").text(j.data["pin_code"]);$("#cd_seconds").val(j.data["seconds"]);$.APP.startTimer("cd");unblockPage(function(){$("#pincode-modal").modal("show")})}}else{showErrors(j);unblockPage()}};let errorCallback=function(j){notyError("System Error");unblockPage();analytics_exception("error when generate pincode",true)};blockPage(null,function(){doAjax($getPinCodeUrlObj.data("url"),$getPinCodeUrlObj.data("method"),{},isAsync,successCallback,errorCallback)})});let checkPincodeInterval;$("#pincode-modal").on("shown.bs.modal",function(){checkPincodeInterval=setInterval(function(){let isAsync=true;let successCallback=function(i){if(i.success){if(i.hasOwnProperty("data")&&i.data.hasOwnProperty("is_pin_code_activated")){if(i.data["is_pin_code_activated"]){try{analytics_action("pin_code_activated")}catch(j){}alert("pincode activated")}}}};let errorCallback=function(i){notyError("System Error");analytics_exception("error when generate pincode",true)};doAjax($isPincodeActivatedUrlObj.data("url"),$isPincodeActivatedUrlObj.data("method"),{},isAsync,successCallback,errorCallback)},10000)});$("#pincode-modal").on("hide.bs.modal",function(){clearInterval(checkPincodeInterval)});$(".renew-sub-btn").click(function(){try{analytics_action("renew_subscription_button")}catch(i){}let isAsync=true;let _data={sub_id:$(this).data("sub_id"),order_code:$(this).data("order_code"),subscription_uuid:$(this).data("subscription_uuid")};let successCallback=function(j){if(j.success){try{analytics_action("renew_subscription_success")}catch(k){}window.location=j.data["redirect_url"]}else{if(j.hasOwnProperty("errors")){showErrors(j)}try{analytics_action("renew_subscription_failed")}catch(k){}}};let errorCallback=function(j){notyError("System Error")};doAjax($renewSubUrlObj.data("url"),$renewSubUrlObj.data("method"),JSON.stringify(_data),isAsync,successCallback,errorCallback)});$(".change-status-device-btn").click(function(){try{analytics_action("change_status_button")}catch(i){}let device_uuid=$(this).data("uuid");let is_active=$(this).data("is_active");let n_status;if(is_active===1){n_status=0}else{n_status=1}d(device_uuid,n_status)});$(".delete-device-btn").click(function(){try{analytics_action("delete_device_button")}catch(i){}let device_uuid=$(this).data("uuid");a(device_uuid)});$emailInput.on("focusout keyup keypress blur change",function(){c()});$("#save-email-btn").click(function(){try{analytics_action("save_email_button")}catch(i){}if($emailInput.hasClass("is-invalid")){markInput($emailInput,false);return false}blockElement(null,$("#save-email-btn"),function(){f($emailInput.val())})});$("#save-password-btn").click(function(){if($emailInput.hasClass("is-invalid")){markInput($emailInput,false);return false}let password=$passwordInput.val();if(!b()){return false}h(password)});$("#account-delete-btn").click(function(){try{analytics_action("account_delete_button")}catch(i){}let emailVal=$.trim($deleteAccountEmailInput.val());if($deleteAccountEmailInput.data("current_email")!==emailVal){markInput($deleteAccountEmailInput,false);$deleteAccountEmailInput.parent().find(".correct_error").show();return false}$deleteAccountEmailInput.parent().find(".error").hide();markInput($deleteAccountEmailInput,true);let data={email:emailVal};let isAsync=true;let successCallback=function(j){if(j.hasOwnProperty("success")&&!j.success){$deleteAccountEmailInput.parent().find(".correct_error").show();markInput($deleteAccountEmailInput,false)}else{if(j.hasOwnProperty("next")){window.location=j.next}}};let errorCallback=function(j){notyError("System Error")};doAjax($deleteAccountUrlObj.data("url"),$deleteAccountUrlObj.data("method"),JSON.stringify(data),isAsync,successCallback,errorCallback)});function d(i,j){let $device=$('.user-device[data-uuid="'+i+'"]');let $deviceChangeStatusButton=$device.find(".change-status-device-btn");let isAsync=true;let data={device_uuid:i,status:j===1};let successCallback=function(k){if(k.hasOwnProperty("success")&&k.success){let $deviceBadge=$device.find(".badge-status");let button_text;let badge_text;if(j===1){$deviceBadge.removeClass("badge-warning").addClass("badge-success");badge_text=$deviceBadge.data("active_text");button_text=$deviceChangeStatusButton.data("deactivate_text")}else{$deviceBadge.removeClass("badge-success").addClass("badge-warning");badge_text=$deviceBadge.data("inactive_text");button_text=$deviceChangeStatusButton.data("activate_text")}$deviceChangeStatusButton.text(button_text);$deviceBadge.text(badge_text);$deviceChangeStatusButton.data("is_active",j);unblockElement($device)}else{showErrors(k)}};let errorCallback=function(k){notyError("System Error")};blockElement(changeStatusUserDeviceBlockText,$device,function(){doAjax($changeStatusUserDeviceUrlObj.data("url"),$changeStatusUserDeviceUrlObj.data("method"),JSON.stringify(data),isAsync,successCallback,errorCallback)})}function a(i){let isAsync=true;let data={device_uuid:i};let successCallback=function(j){if(j.hasOwnProperty("success")&&j.success){$('.user-device[data-uuid="'+i+'"]').remove()}else{showErrors(j)}};let errorCallback=function(j){notyError("System Error")};doAjax($deleteUserDeviceUrlObj.data("url"),$deleteUserDeviceUrlObj.data("method"),JSON.stringify(data),isAsync,successCallback,errorCallback)}function h(i){if(i===""){markInput($passwordInput,false);$passwordInput.parent().find(".empty_error").show();return false}let isAsync=true;let data={password:i};let successCallback=function(j){if(j.hasOwnProperty("success")&&j.success){notySuccess(passwordSavedText);unblockElement($("#save-password-btn"))}else{showErrors(j)}};let errorCallback=function(j){notyError("System Error")};blockElement(null,$("#save-password-btn"),function(){doAjax($updatePasswordUrlObj.data("url"),$updatePasswordUrlObj.data("method"),JSON.stringify(data),isAsync,successCallback,errorCallback)})}function f(i){if(i===""){markInput($emailInput,false);$emailInput.parent().find(".empty_error").show();unblockElement($("#save-email-btn"));return false}if($emailInput.data("current_email")===i){unblockElement($("#save-email-btn"));$emailInput.parent().find(".same_warning").show();return false}let isAsync=true;let data={email:i};let successCallback=function(j){if(j.hasOwnProperty("success")&&j.success){notySuccess(emailSavedText);$emailInput.data("current_email",i);$deleteAccountEmailInput.data("current_email",i)}else{showErrors(j)}unblockElement($("#save-email-btn"))};let errorCallback=function(j){notyError("System Error")};doAjax($updateEmailUrlObj.data("url"),$updateEmailUrlObj.data("method"),JSON.stringify(data),isAsync,successCallback,errorCallback)}function c(){let isEmailEmpty;let emailVal=$.trim($emailInput.val());if(emailVal===""){markInput($emailInput,false);$emailInput.parent().find(".empty_error").show();isEmailEmpty=true;return false}else{if(emailVal.indexOf("@")===-1){markInput($emailInput,false);$emailInput.parent().find(".empty_error").show();isEmailEmpty=true;return false}else{isEmailEmpty=false}}if($emailInput.data("current_email")===emailVal){return false}let data={email:emailVal};let isAsync=true;let successCallback=function(i){if(i.hasOwnProperty("success")&&!i.success){$emailInput.parent().find(".busy_error").show();markInput($emailInput,false)}else{$emailInput.parent().find(".error").hide();if(isEmailEmpty===false){markInput($emailInput,true)}}};let errorCallback=function(i){notyError("System Error")};doAjax($emailCheckURLObj.data("url"),$emailCheckURLObj.data("method"),data,isAsync,successCallback,errorCallback)}function b(){let pwdVal=$.trim($passwordInput.val());let $pwdFormGroup=$passwordInput.parent();if(pwdVal===""){$pwdFormGroup.find(".empty_error").show();markInput($passwordInput,false);return false}else{if(pwdVal.length<6){$pwdFormGroup.find(".short_error").show();markInput($passwordInput,false);return false}else{$pwdFormGroup.find(".short_error").hide();markInput($passwordInput,true);return true}}}setTimeout(function(){$("#vpn_servers-table_filter").hide()},500);$("#vpn_servers-search-input").keyup(function(){try{vpnServersTable.search($(this).val()).draw()}catch(i){console.error("vpnServersTable search error");console.error(i)}});let hash=document.location.hash;let prefix="tab_";if(hash.indexOf(prefix)>-1){$('.nav-tabs a[href="'+hash+'"]').click()}$(".nav-tabs a").click(function(i){$(this).tab("show");let scrollmem=$("body").scrollTop();window.location.hash=this.hash;$("html,body").scrollTop(scrollmem)})});